<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ssafy.tigetting.mapper.RefundMapper">

    <insert id="save" useGeneratedKeys="true" keyProperty="refundId">
        INSERT INTO refunds (payment_id, booking_id, refund_amount, reason, status, requested_at, processed_at, created_at, updated_at)
        VALUES (#{payment.paymentId}, #{booking.bookingId}, #{refundAmount}, #{reason}, #{status}, #{requestedAt}, #{processedAt}, #{createdAt}, #{updatedAt})
    </insert>

    <update id="update">
        UPDATE refunds
        SET status = #{status},
            processed_at = #{processedAt},
            updated_at = #{updatedAt}
        WHERE refund_id = #{refundId}
    </update>

    <select id="findById" resultMap="RefundResultMap">
        SELECT * FROM refunds WHERE refund_id = #{id}
    </select>

    <select id="findByBookingId" resultMap="RefundResultMap">
        SELECT * FROM refunds WHERE booking_id = #{bookingId}
    </select>

    <select id="findByPaymentId" resultMap="RefundResultMap">
        SELECT * FROM refunds WHERE payment_id = #{paymentId}
    </select>

    <resultMap id="RefundResultMap" type="Refund">
        <id property="refundId" column="refund_id"/>
        <result property="refundAmount" column="refund_amount"/>
        <result property="reason" column="reason"/>
        <result property="status" column="status"/>
        <result property="requestedAt" column="requested_at"/>
        <result property="processedAt" column="processed_at"/>
        <result property="createdAt" column="created_at"/>
        <result property="updatedAt" column="updated_at"/>
        <association property="payment" column="payment_id" select="com.ssafy.tigetting.mapper.PaymentMapper.findById"/>
        <association property="booking" column="booking_id" select="com.ssafy.tigetting.mapper.BookingMapper.findById"/>
    </resultMap>

</mapper>
