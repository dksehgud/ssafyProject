<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.ssafy.tigetting.mapper.PerformanceScheduleMapper">

    <insert id="save" useGeneratedKeys="true" keyProperty="scheduleId">
        INSERT INTO performance_schedules (performance_id, show_datetime, total_seats, available_seats, status, booking_start_at, booking_end_at, created_at, updated_at)
        VALUES (#{performance.performanceId}, #{showDatetime}, #{totalSeats}, #{availableSeats}, #{status}, #{bookingStartAt}, #{bookingEndAt}, #{createdAt}, #{updatedAt})
    </insert>

    <update id="update">
        UPDATE performance_schedules
        SET show_datetime = #{showDatetime},
            total_seats = #{totalSeats},
            available_seats = #{availableSeats},
            status = #{status},
            booking_start_at = #{bookingStartAt},
            booking_end_at = #{bookingEndAt},
            updated_at = #{updatedAt}
        WHERE schedule_id = #{scheduleId}
    </update>

    <select id="findById" resultMap="PerformanceScheduleResultMap">
        SELECT * FROM performance_schedules WHERE schedule_id = #{id}
    </select>

    <select id="findByPerformanceId" resultMap="PerformanceScheduleResultMap">
        SELECT * FROM performance_schedules WHERE performance_id = #{performanceId}
    </select>

    <delete id="deleteById">
        DELETE FROM performance_schedules WHERE schedule_id = #{id}
    </delete>

    <resultMap id="PerformanceScheduleResultMap" type="PerformanceSchedule">
        <id property="scheduleId" column="schedule_id"/>
        <result property="showDatetime" column="show_datetime"/>
        <result property="totalSeats" column="total_seats"/>
        <result property="availableSeats" column="available_seats"/>
        <result property="status" column="status"/>
        <result property="bookingStartAt" column="booking_start_at"/>
        <result property="bookingEndAt" column="booking_end_at"/>
        <result property="createdAt" column="created_at"/>
        <result property="updatedAt" column="updated_at"/>
        <association property="performance" column="performance_id" select="com.ssafy.tigetting.mapper.PerformanceMapper.findById"/>
    </resultMap>

</mapper>
