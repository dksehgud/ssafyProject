<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <title>ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ - í‹°ì¼“íŒ… ì‹œìŠ¤í…œ</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 0; padding: 0; background: #f8f9fa; }
        .header { background: #dc3545; color: white; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; }
        .header h1 { margin: 0; font-size: 24px; }
        .logout-btn { background: rgba(255,255,255,0.2); border: 1px solid rgba(255,255,255,0.3); color: white; padding: 8px 16px; border-radius: 4px; cursor: pointer; }
        .logout-btn:hover { background: rgba(255,255,255,0.3); }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .status-card { background: white; border-radius: 8px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .admin-only { background: #fff3cd; border: 1px solid #ffeaa7; color: #856404; padding: 15px; border-radius: 6px; margin-bottom: 20px; }
        .card-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-top: 20px; }
        .card { background: white; border-radius: 8px; padding: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .card h3 { margin-top: 0; color: #dc3545; }
        .btn { display: inline-block; background: #dc3545; color: white; padding: 10px 15px; text-decoration: none; border-radius: 4px; margin: 5px; border: none; cursor: pointer; }
        .btn:hover { background: #c82333; }
        .btn-secondary { background: #6c757d; }
        .btn-secondary:hover { background: #545b62; }
        .error { color: #dc3545; background: #f8d7da; padding: 10px; border-radius: 4px; margin: 10px 0; }
        .success { color: #155724; background: #d4edda; padding: 10px; border-radius: 4px; margin: 10px 0; }
        .unauthorized { text-align: center; padding: 50px; }
    </style>
</head>
<body>
<div class="header">
    <h1>ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</h1>
    <div>
        <span id="adminInfo">ë¡œë”© ì¤‘...</span>
        <button class="logout-btn" onclick="adminLogout()">ë¡œê·¸ì•„ì›ƒ</button>
    </div>
</div>

<div class="container">
    <div class="admin-only">
        ğŸ”’ ê´€ë¦¬ì ì „ìš© ì˜ì—­ì…ë‹ˆë‹¤. ADMIN ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.
    </div>

    <div id="unauthorizedMessage" class="unauthorized" style="display: none;">
        <h2>ì ‘ê·¼ ê¶Œí•œì´ ì—†ìŠµë‹ˆë‹¤</h2>
        <p>ê´€ë¦¬ì ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.</p>
        <a href="/admin-login.html" class="btn">ê´€ë¦¬ì ë¡œê·¸ì¸</a>
    </div>

    <div id="adminContent">
        <div class="status-card">
            <h2>ì‹œìŠ¤í…œ ìƒíƒœ</h2>
            <div id="systemStatus">ìƒíƒœ í™•ì¸ ì¤‘...</div>
            <button class="btn btn-secondary" onclick="checkSystemStatus()">ìƒíƒœ ìƒˆë¡œê³ ì¹¨</button>
        </div>

        <div class="card-grid">
            <div class="card">
                <h3>ì‚¬ìš©ì ê´€ë¦¬</h3>
                <p>ì‹œìŠ¤í…œ ì‚¬ìš©ìë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤.</p>
                <button class="btn" onclick="alert('ì‚¬ìš©ì ê´€ë¦¬ ê¸°ëŠ¥ êµ¬í˜„ ì˜ˆì •')">ì‚¬ìš©ì ëª©ë¡</button>
                <button class="btn btn-secondary" onclick="alert('êµ¬í˜„ ì˜ˆì •')">ê¶Œí•œ ê´€ë¦¬</button>
            </div>

            <div class="card">
                <h3>ì‹œìŠ¤í…œ ëª¨ë‹ˆí„°ë§</h3>
                <p>ì„œë²„ ìƒíƒœì™€ ì„±ëŠ¥ì„ ëª¨ë‹ˆí„°ë§í•©ë‹ˆë‹¤.</p>
                <button class="btn" onclick="checkHealth()">Health Check</button>
                <button class="btn btn-secondary" onclick="alert('êµ¬í˜„ ì˜ˆì •')">ë¡œê·¸ í™•ì¸</button>
            </div>

            <div class="card">
                <h3>ì„¤ì • ê´€ë¦¬</h3>
                <p>ì‹œìŠ¤í…œ ì„¤ì •ì„ ê´€ë¦¬í•©ë‹ˆë‹¤.</p>
                <button class="btn" onclick="alert('êµ¬í˜„ ì˜ˆì •')">ì¼ë°˜ ì„¤ì •</button>
                <button class="btn btn-secondary" onclick="alert('êµ¬í˜„ ì˜ˆì •')">ë³´ì•ˆ ì„¤ì •</button>
            </div>
        </div>
    </div>

    <div id="results" style="margin-top: 20px;"></div>
</div>

<script>
    // í˜ì´ì§€ ë¡œë“œ ì‹œ ê´€ë¦¬ì ê¶Œí•œ í™•ì¸
    window.addEventListener('load', () => {
        checkAdminAccess();
    });

    function checkAdminAccess() {
        const token = localStorage.getItem('accessToken');
        const userType = localStorage.getItem('userType');

        if (!token || userType !== 'ADMIN') {
            document.getElementById('adminContent').style.display = 'none';
            document.getElementById('unauthorizedMessage').style.display = 'block';
            document.getElementById('adminInfo').textContent = 'ê¶Œí•œ ì—†ìŒ';
            return;
        }

        // ê´€ë¦¬ì ìƒíƒœ í™•ì¸
        checkAdminStatus();
    }

    async function checkAdminStatus() {
        const token = localStorage.getItem('accessToken');

        try {
            const response = await fetch('/admin/auth/status', {
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                }
            });

            if (response.ok) {
                const data = await response.json();
                document.getElementById('adminInfo').textContent = `${data.admin} (${data.role})`;
            } else if (response.status === 401 || response.status === 403) {
                // í† í°ì´ ìœ íš¨í•˜ì§€ ì•Šê±°ë‚˜ ê¶Œí•œ ì—†ìŒ
                localStorage.removeItem('accessToken');
                localStorage.removeItem('userType');
                checkAdminAccess();
            } else {
                document.getElementById('adminInfo').textContent = 'ìƒíƒœ í™•ì¸ ì‹¤íŒ¨';
            }
        } catch (error) {
            console.error('ê´€ë¦¬ì ìƒíƒœ í™•ì¸ ì‹¤íŒ¨:', error);
            document.getElementById('adminInfo').textContent = 'ì—°ê²° ì˜¤ë¥˜';
        }
    }

    async function adminLogout() {
        const token = localStorage.getItem('accessToken');

        try {
            const response = await fetch('/admin/auth/logout', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                }
            });

            const result = await response.json();

            // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ í† í° ì‚­ì œ
            localStorage.removeItem('accessToken');
            localStorage.removeItem('userType');

            document.getElementById('results').innerHTML = `
                    <div class="success">
                        ê´€ë¦¬ì ë¡œê·¸ì•„ì›ƒ ì™„ë£Œ: ${result.message}
                    </div>
                `;

            // 2ì´ˆ í›„ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
            setTimeout(() => {
                window.location.href = '/admin/login';  // .html ì œê±°
            }, 2000);

        } catch (error) {
            console.error('ë¡œê·¸ì•„ì›ƒ ì‹¤íŒ¨:', error);
            // ì—ëŸ¬ê°€ ë°œìƒí•´ë„ í´ë¼ì´ì–¸íŠ¸ í† í°ì€ ì‚­ì œ
            localStorage.removeItem('accessToken');
            localStorage.removeItem('userType');
            window.location.href = '/admin-login.html';
        }
    }

    function checkSystemStatus() {
        document.getElementById('systemStatus').innerHTML = `
                ì„œë²„: ì •ìƒ ìš´ì˜ ì¤‘<br>
                ë°ì´í„°ë² ì´ìŠ¤: ì—°ê²°ë¨<br>
                Redis: ì—°ê²°ë¨<br>
                ë§ˆì§€ë§‰ í™•ì¸: ${new Date().toLocaleString()}
            `;
    }

    async function checkHealth() {
        const token = localStorage.getItem('accessToken');

        try {
            const response = await fetch('/actuator/health', {
                headers: { 'Authorization': `Bearer ${token}` }
            });

            const data = await response.text();
            document.getElementById('results').innerHTML = `
                    <div class="success">
                        <strong>Health Check ê²°ê³¼:</strong><br>
                        ìƒíƒœ: ${response.status}<br>
                        ì‘ë‹µ: ${data}
                    </div>
                `;
        } catch (error) {
            document.getElementById('results').innerHTML = `
                    <div class="error">
                        Health Check ì‹¤íŒ¨: ${error.message}
                    </div>
                `;
        }
    }

    // ì´ˆê¸° ì‹œìŠ¤í…œ ìƒíƒœ í™•ì¸
    setTimeout(checkSystemStatus, 1000);
</script>
</body>
</html>